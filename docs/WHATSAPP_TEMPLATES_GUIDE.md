# ๐ ุฏููู ููุงูุจ WhatsApp - UberFix

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุงูู ูุฅุฏุงุฑุฉ ููุงูุจ WhatsApp Business API ูุน ุฏุนู ุฅุฑุณุงู ุงูููุงูุจ ูุจุงุดุฑุฉ ุฅูู Meta ูููุฑุงุฌุนุฉ.

---

## ๐ฏ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### โ ูุง ุชู ุชูููุฐู

1. **ุฅูุดุงุก ุงูููุงูุจ ูุฅุฑุณุงููุง ูู Meta**
   - ูุงุฌูุฉ ุณููุฉ ูุฅูุดุงุก ููุงูุจ ุฌุฏูุฏุฉ
   - ุฏุนู ุงููุชุบูุฑุงุช ุงูุฏููุงููููุฉ
   - ุฅุฑุณุงู ูุจุงุดุฑ ูู Meta API ูููุฑุงุฌุนุฉ

2. **ุฅุฏุงุฑุฉ ุงูููุงูุจ ุงููุนุชูุฏุฉ**
   - ุนุฑุถ ุฌููุน ุงูููุงูุจ ุงููุนุชูุฏุฉ
   - ุญุงูุฉ ุงููุงูุจ (pending, approved, rejected)
   - ุชูุนูู/ุชุนุทูู ุงูููุงูุจ

3. **10 ููุงูุจ ุฌุงูุฒุฉ ููุนุชูุฏุฉ**
   - ููุงูุจ ุฏูุฑุฉ ุญูุงุฉ ุงูุทูุจ
   - ููุงูุจ ุงูุชุฐููุฑ ูุงูููุงุนูุฏ
   - ููุงูุจ ุงูููุงุชูุฑ ูุงูุฏุนู

---

## ๐ ุงููููุงุช ุงููุถุงูุฉ

### APIs
```
app/api/templates/meta/route.ts
```
- `POST /api/templates/meta` - ุฅุฑุณุงู ูุงูุจ ุฌุฏูุฏ ูู Meta
- `GET /api/templates/meta?template_id=xxx` - ุงูุชุญูู ูู ุญุงูุฉ ุงููุงูุจ

### Components
```
components/templates/template-form.tsx
```
- ูููุฐุฌ ุฅูุดุงุก ุงูููุงูุจ
- ุฏุนู ุงููุชุบูุฑุงุช
- ุฏุนู ุงูุฃุฒุฑุงุฑ (URL + Quick Reply)

### Scripts
```
scripts/13-seed-meta-templates.sql
```
- ุฅุถุงูุฉ 10 ููุงูุจ ูุนุชูุฏุฉ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฅูุดุงุก ูุงูุจ ุฌุฏูุฏ

```typescript
// ูู ูุงุฌูุฉ ุงูููุงูุจ
const response = await fetch('/api/templates/meta', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    name: 'order_confirmation',
    category: 'UTILITY', // ุฃู MARKETING
    language: 'ar',
    body: 'ูุฑุญุจุงู {{1}}ุ ุชู ุชุฃููุฏ ุทูุจู ุฑูู {{2}}',
    header: 'ุชุฃููุฏ ุงูุทูุจ', // ุงุฎุชูุงุฑู
    footer: 'UberFix', // ุงุฎุชูุงุฑู
    buttons: [
      {
        type: 'URL',
        text: 'ุชุชุจุน ุงูุทูุจ',
        url: '{{3}}'
      }
    ],
    phoneNumberId: 'YOUR_PHONE_NUMBER_ID'
  })
})
```

### 2. ุฅุฑุณุงู ุฑุณุงูุฉ ุจุงุณุชุฎุฏุงู ูุงูุจ ูุนุชูุฏ

```typescript
const response = await fetch(
  `https://graph.facebook.com/v21.0/${PHONE_NUMBER_ID}/messages`,
  {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${ACCESS_TOKEN}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      messaging_product: 'whatsapp',
      to: '966501234567',
      type: 'template',
      template: {
        name: 'order_confirmation',
        language: { code: 'ar' },
        components: [
          {
            type: 'body',
            parameters: [
              { type: 'text', text: 'ุฃุญูุฏ ูุญูุฏ' },
              { type: 'text', text: 'ORD-001' }
            ]
          },
          {
            type: 'button',
            sub_type: 'url',
            index: 0,
            parameters: [
              { type: 'text', text: 'https://track.uberfix.app/ORD-001' }
            ]
          }
        ]
      }
    })
  }
)
```

---

## ๐ ุงูููุงูุจ ุงููุนุชูุฏุฉ (10 ููุงูุจ)

### 1. invoice_available
**ุงููุฆุฉ:** MARKETING  
**ุงููุชุบูุฑุงุช:** 
- `{{1}}` = ุงุณู ุงูุนููู
- `{{2}}` = ุฑูู ุงููุงุชูุฑุฉ
- `{{3}}` = ุฑุงุจุท ุงููุงุชูุฑุฉ

**ุงููุต:**
```
ูุฑุญุจุงู {{1}}ุ ููุฏ ุฅุนูุงูู ุจุฃู ูุงุชูุฑุชู ุฑูู {{2}} ุฃุตุจุญุช ูุชุงุญุฉ ุงูุขู.
```

### 2. technician_arrival
**ุงููุฆุฉ:** UTILITY  
**ุงููุชุบูุฑุงุช:**
- `{{1}}` = ุงุณู ุงูุนููู
- `{{2}}` = ุงูููุช ุงููุชููุน

**ุงููุต:**
```
ูุฑุญุจูุง {{1}}ุ ุณูุตู ุงูููู ูุฏููุง ุฅูู ูููุนู ุฎูุงู {{2}}.
```

### 3. appointment_scheduling
**ุงููุฆุฉ:** UTILITY  
**ุงููุชุบูุฑุงุช:**
- `{{1}}` = ุงุณู ุงูุนููู
- `{{2}}` = ุงููููุน
- `{{3}}` = ุงูุชุงุฑูุฎ
- `{{4}}` = ููุช ุงูุจุฏุงูุฉ
- `{{5}}` = ููุช ุงูููุงูุฉ

**ุงููุต:**
```
ูุฑุญุจูุง {{1}}ุ ูุญู ูุญุฏุฏ ููุนุฏูุง ูุฒูุงุฑุฉ ููู ุฅูู {{2}} ูู {{3}} ุจูู {{4}} ู {{5}}.
```

### 4. order_canceled
**ุงููุฆุฉ:** UTILITY  
**ุงููุชุบูุฑุงุช:**
- `{{1}}` = ุฑูู ุงูุทูุจ

**ุงููุต:**
```
ูุฑุญุจูุงุ ูุคูุฏ ูู ุฃููุง ุฃูุบููุง ุจูุฌุงุญ ุทูุจู ุฑูู {{1}} ุงูุฐู ูุฏูุชู ูุคุฎุฑูุง.
```

### 5. requests
**ุงููุฆุฉ:** UTILITY  
**ุงููุชุบูุฑุงุช:**
- `{{1}}` = ุงุณู ุงูุนููู
- `{{2}}` = ุฑูู ุงูุทูุจ

**ุงููุต:**
```
ูุฑุญุจูุง {{1}}ุ ุชู ุชุณููู ุทูุจู {{2}} ุจูุฌุงุญ.
```

### 6. support
**ุงููุฆุฉ:** UTILITY  
**ุจุฏูู ูุชุบูุฑุงุช**

**ุงููุต:**
```
ูู ุชุฑุบุจ ูู ุชููู ููุงููุฉ ูู ุฃุญุฏ ููุซูููุงุ
```

### 7. technician_visit
**ุงููุฆุฉ:** UTILITY  
**ุงููุชุบูุฑุงุช:**
- `{{1}}` = ุงุณู ุงูุนููู
- `{{2}}` = ููุน ุงูุฎุฏูุฉ
- `{{3}}` = ุงูุชุงุฑูุฎ
- `{{4}}` = ููุช ุงูุจุฏุงูุฉ
- `{{5}}` = ููุช ุงูููุงูุฉ

**ุงููุต:**
```
ูุฑุญุจูุง {{1}}ุ ูุญู ูุญุฏุฏ ููุนุฏูุง ูุฒูุงุฑุฉ ููู ูู {{2}} ูู {{3}} ุจูู {{4}} ู {{5}}.
```

### 8. uberfix (ุชุฑุญูุจ)
**ุงููุฆุฉ:** MARKETING  
**ุจุฏูู ูุชุบูุฑุงุช**

**ุงููุต:**
```
ููู ูููููุง ูุณุงุนุฏุชู
```

### 9. feedback_survey_form
**ุงููุฆุฉ:** UTILITY  
**ุงููุชุบูุฑุงุช:**
- `{{1}}` = ุงุณู ุงูุดุฑูุฉ
- `{{2}}` = ููุน ุงูุงุณุชุจูุงู
- `{{3}}` = ููุน ุงูุฎุฏูุฉ

**ุงููุต:**
```
ุฅููุง ูู {{1}}ุ ูููู ุงูุชูุงููุง ูุจูุฑูุง ูููุงุญุธุงุช ุงูุนููุงุก. ูุฑุฌู ููู ุฅููุงู {{2}} ูุตูุฑ.
```

### 10. appointment_reschedule_1
**ุงููุฆุฉ:** UTILITY  
**ุงููุชุบูุฑุงุช:**
- `{{1}}` = ุงุณู ุงูุนููู
- `{{2}}` = ุงุณู ุงูุดุฑูุฉ
- `{{3}}` = ุงูุชุงุฑูุฎ
- `{{4}}` = ุงูููุช

**ุงููุต:**
```
ูุฑุญุจุง {{1}}ุ ุชู ุฅุนุงุฏุฉ ุฌุฏููุฉ ููุนุฏู ุงููุงุฏู ูุน {{2}} ุฅูู {{3}} ุงูุณุงุนุฉ {{4}}.
```

---

## ๐ง ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงููุทููุจุฉ

```env
# WhatsApp Business API
WHATSAPP_APP_ID=724370950034089
WHATSAPP_ACCESS_TOKEN=EAAKSz8EpkqkBQ...
WHATSAPP_APP_TOKEN=724370950034089|...
WHATSAPP_API_VERSION=v21.0
```

---

## ๐ ููุงุนุฏ Meta ูุฅูุดุงุก ุงูููุงูุจ

### โ ุงูููุงุนุฏ ุงูุฅูุฒุงููุฉ

1. **ุงุณู ุงููุงูุจ:**
   - ุจุงูุฅูุฌููุฒูุฉ ููุท
   - ุญุฑูู ุตุบูุฑุฉ + ุฃุฑูุงู + underscore
   - ุจุฏูู ูุณุงูุงุช

2. **ุงููุฆุงุช:**
   - `UTILITY` - ุฑุณุงุฆู ุงููุนุงููุงุช ูุงูุฎุฏูุงุช
   - `MARKETING` - ุฑุณุงุฆู ุชุฑููุฌูุฉ
   - `AUTHENTICATION` - OTP ูุฑููุฒ ุงูุชุญูู

3. **ุงููุชุบูุฑุงุช:**
   - ูุฌุจ ุฃู ุชููู ุจุงูุชุฑุชูุจ: `{{1}}`, `{{2}}`, `{{3}}`
   - ูุง ุชูุถุน ุงููุชุบูุฑ ูู ุจุฏุงูุฉ ุฃู ููุงูุฉ ุงููุต
   - ูุฌุจ ุชูููุฑ ุฃูุซูุฉ ูููุชุบูุฑุงุช

4. **ุงูุฃุฒุฑุงุฑ:**
   - ุญุฏ ุฃูุตู 3 ุฃุฒุฑุงุฑ
   - ุฃููุงุน: URL, QUICK_REPLY, PHONE_NUMBER
   - ุฒุฑ URL ูุฌุจ ุฃู ูุญุชูู ุนูู ูุชุบูุฑ ููุฑุงุจุท

### โ ููููุนุงุช

- ูุง ูููู ุชุนุฏูู ูุงูุจ ุจุนุฏ ุงูุงุนุชูุงุฏ
- ูุง ุชุณุชุฎุฏู ูุญุชูู ูุถูู
- ูุง ุชุทูุจ ูุนูููุงุช ุญุณุงุณุฉ
- ูุง ุชุณุชุฎุฏู ุฑูุงุจุท ูุตูุฑุฉ (bit.ly, etc)

---

## ๐ ุญุงูุงุช ุงูููุงูุจ

| ุงูุญุงูุฉ | ุงููุตู |
|--------|-------|
| `pending` | ุชุญุช ุงููุฑุงุฌุนุฉ ูู Meta |
| `approved` | ูุนุชูุฏ ูุฌุงูุฒ ููุงุณุชุฎุฏุงู |
| `rejected` | ูุฑููุถ ูู Meta |
| `disabled` | ูุนุทู ูู ูุจู ุงููุณุชุฎุฏู |

---

## ๐ ุนูููุฉ ุงููุฑุงุฌุนุฉ

1. **ุงูุฅุฑุณุงู:** ุงููุงูุจ ููุฑุณู ูุจุงุดุฑุฉ ูู Meta API
2. **ุงููุฑุงุฌุนุฉ:** Meta ุชุฑุงุฌุน ุงููุงูุจ (24-48 ุณุงุนุฉ)
3. **ุงูุฅุดุนุงุฑ:** ูุชู ุชุญุฏูุซ ุงูุญุงูุฉ ุชููุงุฆูุงู ุนุจุฑ Webhook
4. **ุงูุงุณุชุฎุฏุงู:** ุงููุงูุจ ุงููุนุชูุฏ ูุตุจุญ ูุชุงุญ ููุฅุฑุณุงู

---

## ๐ก ูุตุงุฆุญ ูุฒูุงุฏุฉ ูุนุฏู ุงููุจูู

1. ุงุณุชุฎุฏู ูุบุฉ ูุงุถุญุฉ ููุจุงุดุฑุฉ
2. ุญุฏุฏ ุงูุบุฑุถ ูู ุงูุฑุณุงูุฉ ุจูุถูุญ
3. ูุง ุชุณุชุฎุฏู ูููุงุช ุชุฑููุฌูุฉ ูุจุงูุบ ูููุง
4. ูููุฑ ูููุฉ ุญููููุฉ ูููุณุชุฎุฏู
5. ุงุชุจุน ุณูุงุณุงุช WhatsApp Business

---

## ๐ ุงูุฏุนู

ูููุฒูุฏ ูู ุงููุนูููุงุช:
- [Meta WhatsApp Business API Docs](https://developers.facebook.com/docs/whatsapp)
- [Message Templates Guidelines](https://developers.facebook.com/docs/whatsapp/message-templates/guidelines)
